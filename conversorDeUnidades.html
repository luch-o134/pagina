<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Conversor de monedas</title>
    <link rel="stylesheet" href="conversorDeUnidades.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">  
</head>
<body>
    <div class="center" style="margin-bottom:18px;">
        <button id="btnSalirMenu" class="btn-salir-menu">
            <i class="fa-solid fa-arrow-left"></i> Volver al menÃº principal
        </button>
    </div>
    <div class="textoTipoDeConversion">
        <h1>Seleccione el tipo que quiere convertir</h1>
    </div>
    <div class="center">
        <select id="tipoConversion" style="font-size:18px; margin-bottom:24px;">
            <option value="moneda">Moneda</option>
            <option value="grados">Grados (Â°C â†” Â°F)</option>
            <option value="memoria">Memoria (MB, GB, TB)</option>
            <option value="longitud">Longitud (km, m, cm, mm)</option>
        </select>
    </div>
    <div class="center">
        <div class="card">
            <!-- Moneda -->
            <div id="monedaCampos">
                <div class="rate-info" id="rateInfo">TIPO DE CAMBIO DE MONEDAS</div>

                <label class="label">Cantidad</label>
                <div class="field">
                    <input id="amount" type="number" value="1000" min="0" step="any" />
                    <div class="selector-btn">
                        <button id="btnFrom" class="btn-currency" aria-haspopup="listbox" aria-expanded="false">
                            <span id="fromFlag">ğŸ‡¨ğŸ‡±</span>&nbsp;<span id="fromText">CLP</span>&nbsp;â–¾
                        </button>
                        <div id="dropdownFrom" class="dropdown" aria-hidden="true">
                            <div id="listFrom" class="lista-moneda" role="listbox"></div>
                        </div>
                    </div>
                </div>

                <div class="swap-row">
                    <button id="swapBtn" class="swap" title="Intercambiar"><i class="fa-solid fa-rotate-right"></i></button>
                </div>

                <label class="label">Convertido a</label>
                <div class="field">
                    <div class="output" id="output">0,00</div>
                    <div class="selector-btn">
                        <button id="btnTo" class="btn-currency" aria-haspopup="listbox" aria-expanded="false">
                            <span id="toFlag">ğŸ‡ªğŸ‡º</span>&nbsp;<span id="toText">EUR</span>&nbsp;â–¾
                        </button>
                        <div id="dropdownTo" class="dropdown" aria-hidden="true">
                            <div id="listTo" class="lista-moneda" role="listbox"></div>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <button id="convertBtn" class="convertir">Convertir</button>
                    <div id="message" class="muted"></div>
                </div>
            </div>

            <!-- Grados -->
            <div id="gradosCampos" style="display:none;">
                <label class="label">Cantidad</label>
                <input id="gradosInput" type="number" value="0" step="any" />
                <div class="field">
                    <select id="gradosDe">
                        <option value="C">Celsius (Â°C)</option>
                        <option value="F">Fahrenheit (Â°F)</option>
                    </select>
                    <span style="margin:0 12px;">â†’</span>
                    <select id="gradosA">
                        <option value="C">Celsius (Â°C)</option>
                        <option value="F">Fahrenheit (Â°F)</option>
                    </select>
                </div>
                <div class="output" id="gradosOutput">0,00</div>
                <button id="convertirGradosBtn" class="convertir">Convertir</button>
            </div>

            <!-- Memoria -->
            <div id="memoriaCampos" style="display:none;">
                <label class="label">Cantidad</label>
                <input id="memoriaInput" type="number" value="1" step="any" />
                <div class="field">
                    <select id="memoriaDe">
                        <option value="B">Bytes (B)</option>
                        <option value="KB">Kilobytes (KB)</option>
                        <option value="MB">Megabytes (MB)</option>
                        <option value="GB">Gigabytes (GB)</option>
                        <option value="TB">Terabytes (TB)</option>
                    </select>
                    <span style="margin:0 12px;">â†’</span>
                    <select id="memoriaA">
                        <option value="B">Bytes (B)</option>
                        <option value="KB">Kilobytes (KB)</option>
                        <option value="MB">Megabytes (MB)</option>
                        <option value="GB">Gigabytes (GB)</option>
                        <option value="TB">Terabytes (TB)</option>
                    </select>
                </div>
                <div class="output" id="memoriaOutput">0,00</div>
                <button id="convertirMemoriaBtn" class="convertir">Convertir</button>
            </div>

            <!-- Longitud -->
            <div id="longitudCampos" style="display:none;">
                <label class="label">Cantidad</label>
                <input id="longitudInput" type="number" value="1" step="any" />
                <div class="field">
                    <select id="longitudDe">
                        <option value="mm">MilÃ­metros (mm)</option>
                        <option value="cm">CentÃ­metros (cm)</option>
                        <option value="m">Metros (m)</option>
                        <option value="km">KilÃ³metros (km)</option>
                    </select>
                    <span style="margin:0 12px;">â†’</span>
                    <select id="longitudA">
                        <option value="mm">MilÃ­metros (mm)</option>
                        <option value="cm">CentÃ­metros (cm)</option>
                        <option value="m">Metros (m)</option>
                        <option value="km">KilÃ³metros (km)</option>
                    </select>
                </div>
                <div class="output" id="longitudOutput">0,00</div>
                <button id="convertirLongitudBtn" class="convertir">Convertir</button>
            </div>
        </div>
    </div>
<script>
/* monedas con bandera (aÃ±ade mÃ¡s si quieres) */
const monedas = [
    { code:'USD', name:'DÃ³lar estadounidense', flag:'ğŸ‡ºğŸ‡¸' },
    { code:'EUR', name:'Euro', flag:'ğŸ‡ªğŸ‡º' },
    { code:'GBP', name:'Libra esterlina', flag:'ğŸ‡¬ğŸ‡§' },
    { code:'JPY', name:'Yen japonÃ©s', flag:'ğŸ‡¯ğŸ‡µ' },
    { code:'CLP', name:'Peso chileno', flag:'ğŸ‡¨ğŸ‡±' },
    { code:'MXN', name:'Peso mexicano', flag:'ğŸ‡²ğŸ‡½' },
    { code:'BRL', name:'Real brasileÃ±o', flag:'ğŸ‡§ğŸ‡·' },
    { code:'COP', name:'Peso colombiano', flag:'ğŸ‡¨ğŸ‡´' },
    { code:'PEN', name:'Sol peruano', flag:'ğŸ‡µğŸ‡ª' },
    { code:'ARS', name:'Peso argentino', flag:'ğŸ‡¦ğŸ‡·' },
    { code:'CAD', name:'DÃ³lar canadiense', flag:'ğŸ‡¨ğŸ‡¦' },
    { code:'AUD', name:'DÃ³lar australiano', flag:'ğŸ‡¦ğŸ‡º' },
    { code:'CHF', name:'Franco suizo', flag:'ğŸ‡¨ğŸ‡­' },
    { code:'CNY', name:'Yuan chino', flag:'ğŸ‡¨ğŸ‡³' },
    { code:'INR', name:'Rupia india', flag:'ğŸ‡®ğŸ‡³' },
    { code:'RUB', name:'Rublo ruso', flag:'ğŸ‡·ğŸ‡º' },
    { code:'KRW', name:'Won surcoreano', flag:'ğŸ‡°ğŸ‡·' },
    { code:'TRY', name:'Lira turca', flag:'ğŸ‡¹ğŸ‡·' },
    { code:'ZAR', name:'Rand sudafricano', flag:'ğŸ‡¿ğŸ‡¦' },
    { code:'NZD', name:'DÃ³lar neozelandÃ©s', flag:'ğŸ‡³ğŸ‡¿' },
    { code:'SGD', name:'DÃ³lar de Singapur', flag:'ğŸ‡¸ğŸ‡¬' },
    { code:'HKD', name:'DÃ³lar de Hong Kong', flag:'ğŸ‡­ğŸ‡°' },
    { code:'SEK', name:'Corona sueca', flag:'ğŸ‡¸ğŸ‡ª' },
    { code:'NOK', name:'Corona noruega', flag:'ğŸ‡³ğŸ‡´' },
    { code:'DKK', name:'Corona danesa', flag:'ğŸ‡©ğŸ‡°' },
    { code:'PLN', name:'Zloty polaco', flag:'ğŸ‡µğŸ‡±' },
    { code:'CZK', name:'Corona checa', flag:'ğŸ‡¨ğŸ‡¿' },
    { code:'HUF', name:'Forinto hÃºngaro', flag:'ğŸ‡­ğŸ‡º' },
    { code:'ILS', name:'Shekel israelÃ­', flag:'ğŸ‡®ğŸ‡±' },
    { code:'SAR', name:'Riyal saudÃ­', flag:'ğŸ‡¸ğŸ‡¦' },
    { code:'AED', name:'Dirham de EAU', flag:'ğŸ‡¦ğŸ‡ª' },
    { code:'EGP', name:'Libra egipcia', flag:'ğŸ‡ªğŸ‡¬' },
    { code:'THB', name:'Baht tailandÃ©s', flag:'ğŸ‡¹ğŸ‡­' },
    { code:'IDR', name:'Rupia indonesia', flag:'ğŸ‡®ğŸ‡©' },
    { code:'MYR', name:'Ringgit malayo', flag:'ğŸ‡²ğŸ‡¾' },
    { code:'PHP', name:'Peso filipino', flag:'ğŸ‡µğŸ‡­' },
    { code:'VND', name:'Dong vietnamita', flag:'ğŸ‡»ğŸ‡³' },
    { code:'PKR', name:'Rupia pakistanÃ­', flag:'ğŸ‡µğŸ‡°' },
    { code:'UAH', name:'Grivna ucraniana', flag:'ğŸ‡ºğŸ‡¦' },
    { code:'BGN', name:'Lev bÃºlgaro', flag:'ğŸ‡§ğŸ‡¬' },
    { code:'RON', name:'Leu rumano', flag:'ğŸ‡·ğŸ‡´' },
    { code:'HRK', name:'Kuna croata', flag:'ğŸ‡­ğŸ‡·' },
    { code:'MAD', name:'Dirham marroquÃ­', flag:'ğŸ‡²ğŸ‡¦' },
    { code:'DZD', name:'Dinar argelino', flag:'ğŸ‡©ğŸ‡¿' },
    { code:'NGN', name:'Naira nigeriana', flag:'ğŸ‡³ğŸ‡¬' },
    { code:'KES', name:'ChelÃ­n keniano', flag:'ğŸ‡°ğŸ‡ª' },
    { code:'TZS', name:'ChelÃ­n tanzano', flag:'ğŸ‡¹ğŸ‡¿' },
    { code:'UGX', name:'ChelÃ­n ugandÃ©s', flag:'ğŸ‡ºğŸ‡¬' },
    { code:'GHS', name:'Cedi ghanÃ©s', flag:'ğŸ‡¬ğŸ‡­' },
    { code:'XOF', name:'Franco CFA oeste', flag:'ğŸ‡¸ğŸ‡³' },
    { code:'XAF', name:'Franco CFA centro', flag:'ğŸ‡¨ğŸ‡²' }
];

const btnFrom = document.getElementById('btnFrom');
const btnTo = document.getElementById('btnTo');
const dropdownFrom = document.getElementById('dropdownFrom');
const dropdownTo = document.getElementById('dropdownTo');
const listFrom = document.getElementById('listFrom');
const listTo = document.getElementById('listTo');
const fromText = document.getElementById('fromText');
const toText = document.getElementById('toText');
const fromFlag = document.getElementById('fromFlag');
const toFlag = document.getElementById('toFlag');
const amountInput = document.getElementById('amount');
const convertBtn = document.getElementById('convertBtn');
const output = document.getElementById('output');
const rateInfo = document.getElementById('rateInfo');
const message = document.getElementById('message');
const swapBtn = document.getElementById('swapBtn');
const tipoConversion = document.getElementById('tipoConversion');
const card = document.querySelector('.card');

const monedaCampos = document.getElementById('monedaCampos');
const gradosCampos = document.getElementById('gradosCampos');
const memoriaCampos = document.getElementById('memoriaCampos');
const longitudCampos = document.getElementById('longitudCampos');

let fromCode = 'CLP';
let toCode = 'EUR';

function renderList(container) {
    container.innerHTML = monedas.map(m =>
        `<div class="moneda-item" tabindex="0" data-code="${m.code}" data-flag="${m.flag}">
            <strong>${m.code}</strong> â€” ${m.name}
         </div>`
    ).join('');
}

/* abrir dropdown (aparece arriba; CSS controla posiciÃ³n). list tiene scroll por CSS */
function openDropdown(drop, btn) {
    // llenar lista si estÃ¡ vacÃ­a
    const list = drop.querySelector('.lista-moneda');
    if (list && list.children.length === 0) renderList(list);

    // igualar ancho del dropdown al botÃ³n
    drop.style.minWidth = btn.offsetWidth + 'px';
    drop.classList.add('open');
    drop.setAttribute('aria-hidden','false');
    btn.setAttribute('aria-expanded','true');

    // opcional: mostrar desde arriba (scrollTop = list.scrollHeight)
    // list.scrollTop = list.scrollHeight; // si quieres que aparezca "subiendo"
}

function closeDropdown(drop, btn) {
    drop.classList.remove('open');
    drop.setAttribute('aria-hidden','true');
    if (btn) btn.setAttribute('aria-expanded','false');
}

btnFrom.addEventListener('click', (e) => {
    e.stopPropagation();
    if (dropdownFrom.classList.contains('open')) closeDropdown(dropdownFrom, btnFrom);
    else { closeDropdown(dropdownTo, btnTo); openDropdown(dropdownFrom, btnFrom); }
});
btnTo.addEventListener('click', (e) => {
    e.stopPropagation();
    if (dropdownTo.classList.contains('open')) closeDropdown(dropdownTo, btnTo);
    else { closeDropdown(dropdownFrom, btnFrom); openDropdown(dropdownTo, btnTo); }
});

// cerrar al clic fuera
document.addEventListener('click', (e) => {
    if (!btnFrom.contains(e.target) && !dropdownFrom.contains(e.target)) closeDropdown(dropdownFrom, btnFrom);
    if (!btnTo.contains(e.target) && !dropdownTo.contains(e.target)) closeDropdown(dropdownTo, btnTo);
});

// seleccionar con delegaciÃ³n
listFrom.addEventListener('click', (e) => {
    const item = e.target.closest('.moneda-item');
    if (!item) return;
    fromCode = item.dataset.code;
    fromFlag.textContent = item.dataset.flag;
    fromText.textContent = fromCode;
    closeDropdown(dropdownFrom, btnFrom);
});
listTo.addEventListener('click', (e) => {
    const item = e.target.closest('.moneda-item');
    if (!item) return;
    toCode = item.dataset.code;
    toFlag.textContent = item.dataset.flag;
    toText.textContent = toCode;
    closeDropdown(dropdownTo, btnTo);
});

// permitir selecciÃ³n con Enter cuando el item estÃ¡ enfocado
listFrom.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        const item = document.activeElement.closest && document.activeElement.closest('.moneda-item');
        if (item) { item.click(); }
    }
});
listTo.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        const item = document.activeElement.closest && document.activeElement.closest('.moneda-item');
        if (item) { item.click(); }
    }
});

// swap
swapBtn.addEventListener('click', () => {
    const aCode = fromCode; fromCode = toCode; toCode = aCode;
    const aFlag = fromFlag.textContent; fromFlag.textContent = toFlag.textContent; toFlag.textContent = aFlag;
    fromText.textContent = fromCode; toText.textContent = toCode;
});

// Convertir usando open.er-api.com (pÃºblico) y fallback a frankfurter.app
async function convertir() {
    const amount = parseFloat(amountInput.value);
    if (isNaN(amount) || amount < 0) { message.textContent = 'Cantidad invÃ¡lida'; return; }
    if (fromCode === toCode) { output.textContent = `${amount.toLocaleString()} ${fromCode}`; return; }

    message.textContent = '';
    output.textContent = 'Convirtiendo...';

    try {
        // 1) open.er-api.com (no requiere clave)
        const url = `https://open.er-api.com/v6/latest/${encodeURIComponent(fromCode)}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('HTTP ' + res.status + ' open.er-api.com');
        const data = await res.json();
        console.log('open.er-api.com:', data);

        if (data && (data.result === 'success' || data.result === 'ok') && data.rates && typeof data.rates[toCode] === 'number') {
            const rate = Number(data.rates[toCode]);
            const value = rate * amount;
            output.textContent = `${value.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:6})} ${toCode}`;
            rateInfo.textContent = `1 ${fromCode} = ${rate} ${toCode}`;
            return;
        }

        // 2) Fallback: frankfurter.app (sin clave)
        const url2 = `https://api.frankfurter.app/latest?from=${encodeURIComponent(fromCode)}&to=${encodeURIComponent(toCode)}`;
        const res2 = await fetch(url2);
        if (!res2.ok) throw new Error('HTTP ' + res2.status + ' frankfurter.app');
        const data2 = await res2.json();
        console.log('frankfurter.app:', data2);

        if (data2 && data2.rates && typeof data2.rates[toCode] === 'number') {
            const rate = Number(data2.rates[toCode]);
            const value = rate * amount;
            output.textContent = `${value.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:6})} ${toCode}`;
            rateInfo.textContent = `1 ${fromCode} = ${rate} ${toCode}`;
            return;
        }

        console.error('Ninguna API devolviÃ³ una tasa vÃ¡lida', { open: data, frankfurter: data2 });
        output.textContent = 'No se pudo obtener la tasa (revisa la consola)';
        message.textContent = 'Si usas file://, abre la pÃ¡gina con http://localhost:8000 para evitar problemas CORS.';
    } catch (err) {
        console.error(err);
        output.textContent = 'Error de red';
        message.textContent = 'Revisa la consola';
    }
}

convertBtn.addEventListener('click', convertir);

tipoConversion.addEventListener('change', function() {
    const tipo = tipoConversion.value;
    monedaCampos.style.display = tipo === 'moneda' ? '' : 'none';
    gradosCampos.style.display = tipo === 'grados' ? '' : 'none';
    memoriaCampos.style.display = tipo === 'memoria' ? '' : 'none';
    longitudCampos.style.display = tipo === 'longitud' ? '' : 'none';
});

// Ejemplo de funciÃ³n para convertir grados
function convertirGrados(valor, de, a) {
    if (de === 'C' && a === 'F') return valor * 9/5 + 32;
    if (de === 'F' && a === 'C') return (valor - 32) * 5/9;
    return valor;
}

// Ejemplo de funciÃ³n para convertir memoria
function convertirMemoria(valor, de, a) {
    const unidades = { B:1, KB:1024, MB:1024**2, GB:1024**3, TB:1024**4 };
    return valor * (unidades[de] / unidades[a]);
}

// Ejemplo de funciÃ³n para convertir longitud
function convertirLongitud(valor, de, a) {
    const unidades = { mm:1, cm:10, m:1000, km:1000000 };
    return valor * (unidades[de] / unidades[a]);
}

// ConversiÃ³n de grados
document.getElementById('convertirGradosBtn').onclick = function() {
    const valor = parseFloat(document.getElementById('gradosInput').value);
    const de = document.getElementById('gradosDe').value;
    const a = document.getElementById('gradosA').value;
    if (isNaN(valor)) {
        document.getElementById('gradosOutput').textContent = 'Valor invÃ¡lido';
        return;
    }
    let resultado = convertirGrados(valor, de, a);
    document.getElementById('gradosOutput').textContent = resultado.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:6}) + ' ' + a;
};

// ConversiÃ³n de memoria
document.getElementById('convertirMemoriaBtn').onclick = function() {
    const valor = parseFloat(document.getElementById('memoriaInput').value);
    const de = document.getElementById('memoriaDe').value;
    const a = document.getElementById('memoriaA').value;
    if (isNaN(valor)) {
        document.getElementById('memoriaOutput').textContent = 'Valor invÃ¡lido';
        return;
    }
    let resultado = convertirMemoria(valor, de, a);
    document.getElementById('memoriaOutput').textContent = resultado.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:6}) + ' ' + a;
};

// ConversiÃ³n de longitud
document.getElementById('convertirLongitudBtn').onclick = function() {
    const valor = parseFloat(document.getElementById('longitudInput').value);
    const de = document.getElementById('longitudDe').value;
    const a = document.getElementById('longitudA').value;
    if (isNaN(valor)) {
        document.getElementById('longitudOutput').textContent = 'Valor invÃ¡lido';
        return;
    }
    let resultado = convertirLongitud(valor, de, a);
    document.getElementById('longitudOutput').textContent = resultado.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:6}) + ' ' + a;
};

// inicializar
fromText.textContent = fromCode; toText.textContent = toCode;
fromFlag.textContent = 'ğŸ‡¨ğŸ‡±'; toFlag.textContent = 'ğŸ‡ªğŸ‡º';
renderList(listFrom);
renderList(listTo);

document.getElementById('btnSalirMenu').onclick = function() {
    window.location.href = 'index.html';
};
</script>
</body>
</html>